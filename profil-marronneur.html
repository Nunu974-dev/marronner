<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profil Marronneur ‚Äì Marronner</title>
  <link rel="stylesheet" href="css/style.css?v=20241202-2040">
  <link rel="stylesheet" href="css/chatbot.css?v=20241202-2040">
  <link rel="icon" href="img/favicon.png">
  
  <style>
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
  
  <!-- Supabase SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

  <!-- HEADER -->
  <header>
    <div class="navbar container">
      <a href="index.html" class="logo">Marronner</a>
      <nav class="menu">
        <a href="categories.html">Cat√©gories</a>
        <a href="publier-demande.html">Publier une demande</a>
        <a href="demandes.html">Demandes ouvertes</a>
        <a href="tableau-de-bord.html" id="userProfileLink">üë§ <span id="userTypeDisplay">Chercheur</span></a>
        <a href="#" id="logoutBtn" class="cta">D√©connexion</a>
      </nav>
    </div>
  </header>

  <!-- CONTENU -->
  <section style="padding: 80px 20px 40px;">
    <div class="container" style="max-width: 1200px; margin: 0 auto;">
      
      <!-- Retour -->
      <a href="javascript:history.back()" style="display: inline-flex; align-items: center; gap: 8px; color: var(--secondary); text-decoration: none; font-weight: 600; margin-bottom: 30px;">
        ‚Üê Retour
      </a>

      <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 30px; align-items: start;">
        
        <!-- COLONNE GAUCHE - Infos principales -->
        <div style="background: white; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); overflow: hidden; position: sticky; top: 100px;">
          
          <!-- Avatar et nom -->
          <div style="background: linear-gradient(135deg, var(--primary), var(--secondary)); padding: 40px 30px; text-align: center; color: white;">
            <div id="marronneurAvatar" style="width: 120px; height: 120px; background: white; border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; font-size: 3.5em; box-shadow: 0 4px 20px rgba(0,0,0,0.2);">
              <div class="loader" style="border: 4px solid #f3f3f3; border-top: 4px solid var(--secondary); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite;"></div>
            </div>
            <h1 id="marronneurName" style="margin: 0 0 10px 0; font-size: 2em; color: white;">Chargement...</h1>
            <p id="marronneurTitle" style="margin: 0 0 15px 0; font-size: 1.1em; opacity: 0.95; color: white;">‚è≥</p>
            <div style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 15px;">
              <span style="color: #fbbf24; font-size: 1.3em; font-weight: 700;">‚≠ê <span id="marronneurRating">-</span></span>
              <span style="opacity: 0.9; color: white;">(<span id="marronneurReviews">-</span> avis)</span>
            </div>
            <div style="display: flex; gap: 8px; flex-wrap: wrap; justify-content: center;">
              <span id="topBadge" style="background: rgba(255,255,255,0.25); backdrop-filter: blur(10px); color: white; padding: 6px 14px; border-radius: 20px; font-size: 0.85em; font-weight: 600; display: inline-flex; align-items: center; gap: 5px;">
                üèÜ Top marronneur
              </span>
              <span id="verifiedBadge" style="background: rgba(16,185,129,0.9); color: white; padding: 6px 14px; border-radius: 20px; font-size: 0.85em; font-weight: 600; display: inline-flex; align-items: center; gap: 5px;">
                ‚úì V√©rifi√©
              </span>
            </div>
          </div>

          <!-- Informations cl√©s -->
          <div style="padding: 30px;">
            <div style="margin-bottom: 25px;">
              <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                <span style="font-size: 1.3em;">üìç</span>
                <span style="color: #6b7280; font-size: 0.9em;">Localisation</span>
              </div>
              <p id="marronneurLocation" style="margin: 0; font-weight: 600; color: #1f2937; margin-left: 35px;">...</p>
            </div>

            <div style="margin-bottom: 25px;">
              <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                <span style="font-size: 1.3em;">üíº</span>
                <span style="color: #6b7280; font-size: 0.9em;">Exp√©rience</span>
              </div>
              <p id="marronneurExperience" style="margin: 0; font-weight: 600; color: #1f2937; margin-left: 35px;">...</p>
            </div>

            <div style="margin-bottom: 25px;">
              <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                <span style="font-size: 1.3em;">‚úÖ</span>
                <span style="color: #6b7280; font-size: 0.9em;">Projets r√©alis√©s</span>
              </div>
              <p id="marronneurProjects" style="margin: 0; font-weight: 600; color: #1f2937; margin-left: 35px;">...</p>
            </div>

            <div style="margin-bottom: 25px;">
              <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                <span style="font-size: 1.3em;">‚ö°</span>
                <span style="color: #6b7280; font-size: 0.9em;">D√©lai moyen</span>
              </div>
              <p id="marronneurDelay" style="margin: 0; font-weight: 600; color: #1f2937; margin-left: 35px;">...</p>
            </div>

            <div style="margin-bottom: 30px;">
              <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                <span style="font-size: 1.3em;">üí∞</span>
                <span style="color: #6b7280; font-size: 0.9em;">Tarif horaire</span>
              </div>
              <p id="marronneurRate" style="margin: 0; font-weight: 600; color: var(--secondary); font-size: 1.2em; margin-left: 35px;">...</p>
            </div>

            <button onclick="contactMarronneur()" style="width: 100%; padding: 14px 20px; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; border: none; border-radius: 10px; font-weight: 600; font-size: 1.05em; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 12px;">
              üí¨ Envoyer un message
            </button>

            <button onclick="addToFavorites()" style="width: 100%; padding: 14px 20px; background: white; color: var(--secondary); border: 2px solid var(--secondary); border-radius: 10px; font-weight: 600; font-size: 1.05em; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 10px;">
              ‚≠ê Ajouter aux favoris
            </button>
          </div>
        </div>

        <!-- COLONNE DROITE - D√©tails du profil -->
        <div>
          
          <!-- √Ä propos -->
          <div style="background: white; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 35px; margin-bottom: 25px;">
            <h2 style="margin: 0 0 20px 0; color: var(--primary); display: flex; align-items: center; gap: 10px;">
              <span style="font-size: 1.4em;">üë§</span>
              √Ä propos
            </h2>
            <p id="marronneurAbout" style="margin: 0; line-height: 1.8; color: #4b5563; font-size: 1.05em;">
              <span style="color: #9ca3af;">Chargement de la bio...</span>
            </p>
          </div>

          <!-- Comp√©tences -->
          <div style="background: white; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 35px; margin-bottom: 25px;">
            <h2 style="margin: 0 0 20px 0; color: var(--primary); display: flex; align-items: center; gap: 10px;">
              <span style="font-size: 1.4em;">üéØ</span>
              Comp√©tences
            </h2>
            <div id="competencesList" style="display: flex; flex-wrap: wrap; gap: 10px;">
              <span style="color: #9ca3af;">Chargement...</span>
            </div>
          </div>

          <!-- Services propos√©s -->
          <div style="background: white; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 35px; margin-bottom: 25px;">
            <h2 style="margin: 0 0 20px 0; color: var(--primary); display: flex; align-items: center; gap: 10px;">
              <span style="font-size: 1.4em;">üì¶</span>
              Services propos√©s
            </h2>
            <div id="servicesList" style="display: grid; gap: 15px;">
              <p style="color: #9ca3af; text-align: center; padding: 20px;">Chargement des services...</p>
            </div>
          </div>

          <!-- Exp√©rience professionnelle -->
          <div id="experienceSection" style="background: white; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 35px; margin-bottom: 25px; display: none;">
            <h2 style="margin: 0 0 20px 0; color: var(--primary); display: flex; align-items: center; gap: 10px;">
              <span style="font-size: 1.4em;">üíº</span>
              Exp√©rience professionnelle
            </h2>
            <div id="experienceList" style="display: grid; gap: 20px;">
              <!-- Exp√©riences dynamiques -->
            </div>
          </div>

          <!-- Portfolio / R√©alisations -->
          <div style="background: white; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 35px; margin-bottom: 25px;">
            <h2 style="margin: 0 0 20px 0; color: var(--primary); display: flex; align-items: center; gap: 10px;">
              <span style="font-size: 1.4em;">üñºÔ∏è</span>
              Portfolio
            </h2>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
              <div style="aspect-ratio: 1; background: #f3f4f6; border-radius: 12px; display: flex; align-items: center; justify-content: center; color: #9ca3af;">
                <div class="loader" style="border: 4px solid #e5e7eb; border-top: 4px solid var(--secondary); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite;"></div>
              </div>
            </div>
            <p style="margin: 20px 0 0 0; text-align: center; color: #6b7280; font-size: 0.9em;">
              Cliquez sur une image pour voir le projet en d√©tail
            </p>
          </div>

          <!-- Avis clients -->
          <div style="background: white; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 35px; margin-bottom: 25px;">
            <h2 style="margin: 0 0 25px 0; color: var(--primary); display: flex; align-items: center; gap: 10px;">
              <span style="font-size: 1.4em;">‚≠ê</span>
              Avis clients (<span id="reviewsCount">45</span>)
            </h2>

            <!-- Avis 1 -->
            <div style="border-bottom: 1px solid #e5e7eb; padding-bottom: 25px; margin-bottom: 25px;">
              <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                <div>
                  <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                    <div style="width: 45px; height: 45px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">JM</div>
                    <div>
                      <h4 style="margin: 0; color: #1f2937; font-size: 1.05em;">Jean Martin</h4>
                      <p style="margin: 0; color: #9ca3af; font-size: 0.85em;">Restaurant Le Palmier</p>
                    </div>
                  </div>
                </div>
                <div style="text-align: right;">
                  <div style="color: #f59e0b; font-weight: 600; margin-bottom: 3px;">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 5.0</div>
                  <p style="margin: 0; color: #9ca3af; font-size: 0.8em;">Il y a 2 semaines</p>
                </div>
              </div>
              <p style="margin: 0; color: #4b5563; line-height: 1.7; font-size: 0.95em;">
                Excellente collaboration avec Marie ! Elle a su comprendre mes besoins et cr√©er un logo qui repr√©sente parfaitement l'esprit de mon restaurant. Professionnelle, √† l'√©coute et cr√©ative. Je recommande vivement ! üé®‚ú®
              </p>
            </div>

            <!-- Avis 2 -->
            <div style="border-bottom: 1px solid #e5e7eb; padding-bottom: 25px; margin-bottom: 25px;">
              <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                <div>
                  <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                    <div style="width: 45px; height: 45px; background: linear-gradient(135deg, #f59e0b, #d97706); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">SL</div>
                    <div>
                      <h4 style="margin: 0; color: #1f2937; font-size: 1.05em;">Sophie Leroy</h4>
                      <p style="margin: 0; color: #9ca3af; font-size: 0.85em;">Boutique Cr√©ole Chic</p>
                    </div>
                  </div>
                </div>
                <div style="text-align: right;">
                  <div style="color: #f59e0b; font-weight: 600; margin-bottom: 3px;">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 5.0</div>
                  <p style="margin: 0; color: #9ca3af; font-size: 0.8em;">Il y a 1 mois</p>
                </div>
              </div>
              <p style="margin: 0; color: #4b5563; line-height: 1.7; font-size: 0.95em;">
                Marie a cr√©√© toute l'identit√© visuelle de ma boutique. Le r√©sultat d√©passe mes attentes ! Design moderne, couleurs parfaites, et elle a respect√© tous les d√©lais. Merci pour ce superbe travail ! üíØ
              </p>
            </div>

            <!-- Avis 3 -->
            <div style="padding-bottom: 5px;">
              <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                <div>
                  <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                    <div style="width: 45px; height: 45px; background: linear-gradient(135deg, #10b981, #059669); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">PR</div>
                    <div>
                      <h4 style="margin: 0; color: #1f2937; font-size: 1.05em;">Pierre Rivi√®re</h4>
                      <p style="margin: 0; color: #9ca3af; font-size: 0.85em;">Auto-entrepreneur</p>
                    </div>
                  </div>
                </div>
                <div style="text-align: right;">
                  <div style="color: #f59e0b; font-weight: 600; margin-bottom: 3px;">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 5.0</div>
                  <p style="margin: 0; color: #9ca3af; font-size: 0.8em;">Il y a 3 mois</p>
                </div>
              </div>
              <p style="margin: 0; color: #4b5563; line-height: 1.7; font-size: 0.95em;">
                Tr√®s satisfait du logo cr√©√© par Marie. Elle a pris le temps d'√©changer, de comprendre mon activit√© et a propos√© plusieurs versions. Rapport qualit√©/prix imbattable. Je la solliciterai √† nouveau ! üëç
              </p>
            </div>

            <div style="text-align: center; margin-top: 25px;">
              <button onclick="alert('üìù Page des avis compl√®te √† venir')" style="padding: 12px 30px; background: #f3f4f6; color: #4b5563; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                Voir tous les avis (45)
              </button>
            </div>
          </div>

        </div>
      </div>

    </div>
  </section>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="footer-container container">
      <div class="footer-column">
        <h3>Marronner</h3>
        <p>La plateforme 100 % locale qui connecte talents et besoins √† La R√©union <img src="img/logo.jpg" alt="La R√©union" class="logo-inline">.<br>
        Trouve, propose et collabore en toute simplicit√©.</p>
      </div>

      <div class="footer-column">
        <h4>Navigation</h4>
        <ul>
          <li><a href="comment-ca-marche.html">Comment √ßa marche</a></li>
          <li><a href="faq.html">FAQ</a></li>
          <li><a href="categories.html">Cat√©gories</a></li>
          <li><a href="demandes.html">Derni√®res demandes</a></li>
        </ul>
      </div>

      <div class="footer-column">
        <h4>Pour les chercheurs</h4>
        <ul>
          <li><a href="publier-demande.html">Publier une demande</a></li>
          <li><a href="inscription.html" class="auth-link logged-out">S'inscrire</a></li>
          <li><a href="connexion.html" class="auth-link logged-out">Connexion</a></li>
        </ul>
        <h4 style="margin-top: 20px;">Pour les marronneurs</h4>
        <ul>
          <li><a href="devenir-freelance.html">Devenir marronneur</a></li>
          <li><a href="gerer-commandes.html">G√©rer ses commandes</a></li>
          <li><a href="obtenir-avis.html">Obtenir des avis</a></li>
        </ul>
      </div>

      <div class="footer-column">
        <h4>Mon compte</h4>
        <ul>
          <li><a href="tableau-de-bord.html">Tableau de bord</a></li>
          <li><a href="messagerie.html">Messagerie</a></li>
        </ul>
        <h4 style="margin-top: 20px;">Informations</h4>
        <ul>
          <li><a href="cgu.html">CGU</a></li>
          <li><a href="confidentialite.html">Confidentialit√©</a></li>
          <li><a href="mentions-legales.html">Mentions l√©gales</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-bottom">
      <p>¬© 2025 Marronner ‚Äì Tous droits r√©serv√©s.</p>
      <p>Fait avec ‚ù§Ô∏è √† La R√©union <img src="img/logo.jpg" alt="La R√©union" class="logo-inline"></p>
    </div>
  </footer>

  <!-- SCRIPTS -->
<script src="js/supabase-config.js?v=20241217-0115"></script>
  <script src="js/main.js?v=20241203-0300"></script>
  <script src="js/main.js?v=20241202-2040"></script>
  <script>
    // Initialiser l'authentification pour le header
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        const user = await getCurrentUser();
        if (user) {
          const profileResult = await getUserProfile(user.id);
          if (profileResult.success) {
            const userTypeDisplay = document.getElementById('userTypeDisplay');
            if (userTypeDisplay) {
              userTypeDisplay.textContent = profileResult.data.user_type === 'chercheur' ? 'Chercheur' : 'Marronneur';
            }
          }
        }
      } catch (error) {
        console.log('Utilisateur non connect√©');
      }
    });

    // R√©cup√©rer l'ID du marronneur depuis l'URL ou l'utilisateur connect√©
    const urlParams = new URLSearchParams(window.location.search);
    const marronneurId = urlParams.get('id'); // Si on veut voir un profil sp√©cifique
    const marronneurName = urlParams.get('name'); // Pour la compatibilit√© avec l'ancien syst√®me

    // Charger le profil r√©el depuis Supabase
    loadMarronneurProfile();

    async function loadMarronneurProfile() {
      console.log('üîç D√©but chargement profil...');
      console.log('URL params - ID:', marronneurId, 'Name:', marronneurName);
      
      try {
        let profile;
        
        // Si un ID est fourni, charger ce profil
        if (marronneurId) {
          console.log('üì• Chargement profil par ID:', marronneurId);
          const { data, error } = await supabase
            .from('profiles')
            .select('*')
            .eq('id', marronneurId)
            .eq('user_type', 'marronneur')
            .single();
          
          if (error) {
            console.error('‚ùå Erreur chargement par ID:', error);
            throw error;
          }
          profile = data;
          console.log('‚úÖ Profil charg√© par ID:', profile);
        } 
        // Sinon, charger le profil de l'utilisateur connect√©
        else {
          console.log('üë§ Chargement profil utilisateur connect√©...');
          const { data: { user } } = await supabase.auth.getUser();
          
          if (!user) {
            console.log('‚ùå Utilisateur non connect√©');
            // Si pas connect√© et pas d'ID, rediriger vers connexion
            if (!marronneurName) {
              window.location.href = 'connexion.html';
              return;
            }
            // Sinon afficher profil fictif
            console.log('üìã Affichage profil fictif:', marronneurName);
            loadFictiveProfile(marronneurName);
            return;
          }

          console.log('‚úÖ Utilisateur connect√©:', user.id);
          const { data, error } = await supabase
            .from('profiles')
            .select('*')
            .eq('id', user.id)
            .single();
          
          if (error) {
            console.error('‚ùå Erreur chargement profil:', error);
            throw error;
          }
          
          if (!data) {
            console.error('‚ùå Aucune donn√©e de profil trouv√©e');
            alert('Profil introuvable. Merci de compl√©ter ton onboarding.');
            window.location.href = 'onboarding.html';
            return;
          }
          
          profile = data;
          console.log('‚úÖ Profil charg√©:', profile);

          // Si l'utilisateur est marronneur et regarde son propre profil, ajouter un bouton modifier
          if (profile.user_type === 'marronneur') {
            addEditButton();
          }
        }

        // V√©rifier que le profil existe avant d'afficher
        if (!profile) {
          throw new Error('Profil vide');
        }

        // Afficher le profil r√©el
        console.log('üé® Affichage du profil...');
        displayRealProfile(profile);
        
      } catch (error) {
        console.error('üí• ERREUR FATALE:', error);
        
        // Ne pas afficher profil fictif, montrer l'erreur
        alert(`Erreur de chargement du profil:\n${error.message}\n\nV√©rifie la console (F12) pour plus de d√©tails.`);
        
        // Proposer de retourner au tableau de bord
        setTimeout(() => {
          if (confirm('Retourner au tableau de bord ?')) {
            window.location.href = 'tableau-de-bord.html';
          }
        }, 500);
      }
    }

    function displayRealProfile(profile) {
      console.log('üé® Affichage profil r√©el:', profile);
      
      // 1. NOM ET AVATAR
      document.getElementById('marronneurName').textContent = `${profile.first_name} ${profile.last_name}`;
      
      // Avatar - soit emoji soit photo
      const avatarElement = document.getElementById('marronneurAvatar');
      if (profile.profile_photo) {
        // Si c'est une URL d'image
        if (profile.profile_photo.startsWith('http')) {
          avatarElement.innerHTML = `<img src="${profile.profile_photo}" alt="Photo de profil" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
        } else {
          // Sinon c'est un emoji
          avatarElement.textContent = profile.profile_photo;
        }
      } else {
        avatarElement.textContent = 'üë§';
      }
      
      // 2. TITRE bas√© sur les cat√©gories
      const categories = profile.categories || [];
      const title = categories.length > 0 ? categories[0] : 'Professionnel';
      document.getElementById('marronneurTitle').textContent = title;
      
      // 3. NOTE ET AVIS (√† impl√©menter avec vraie table)
      document.getElementById('marronneurRating').textContent = '5.0';
      document.getElementById('marronneurReviews').textContent = '0';
      
      // 4. LOCALISATION - afficher zone d'intervention
      const locationElement = document.getElementById('marronneurLocation');
      if (profile.zone_intervention) {
        locationElement.textContent = profile.zone_intervention.charAt(0).toUpperCase() + profile.zone_intervention.slice(1);
      } else {
        locationElement.textContent = 'La R√©union';
      }
      
      // 5. EXP√âRIENCE - afficher la plus r√©cente ou compter
      const experienceElement = document.getElementById('marronneurExperience');
      if (profile.experience && Array.isArray(profile.experience) && profile.experience.length > 0) {
        // Calculer ann√©es d'exp√©rience depuis la plus ancienne
        const years = profile.experience.map(exp => {
          const start = parseInt(exp.yearStart) || new Date().getFullYear();
          return new Date().getFullYear() - start;
        });
        const maxYears = Math.max(...years);
        experienceElement.textContent = `${maxYears}+ ann√©es`;
      } else if (typeof profile.experience === 'string') {
        experienceElement.textContent = profile.experience;
      } else {
        experienceElement.textContent = 'D√©butant';
      }
      
      document.getElementById('marronneurProjects').textContent = '0 projets'; // √Ä calculer depuis les commandes
      document.getElementById('marronneurDelay').textContent = profile.disponibilite || 'Variable';
      
      // 6. TARIF
      if (profile.tarif_horaire) {
        document.getElementById('marronneurRate').textContent = `${profile.tarif_horaire}‚Ç¨/h`;
      } else {
        document.getElementById('marronneurRate').textContent = 'Sur devis';
      }
      
      // 7. BIO
      const bioElement = document.getElementById('marronneurAbout');
      if (bioElement && profile.bio) {
        bioElement.textContent = profile.bio;
      }
      
      // 8. COMP√âTENCES
      if (profile.competences && profile.competences.length > 0) {
        const competencesContainer = document.getElementById('competencesList');
        competencesContainer.innerHTML = '';
        profile.competences.forEach(comp => {
          const badge = document.createElement('span');
          badge.style.cssText = 'background: linear-gradient(135deg, #eff6ff, #dbeafe); color: var(--secondary); padding: 10px 18px; border-radius: 25px; font-weight: 600; font-size: 0.95em; border: 1px solid #bfdbfe;';
          badge.textContent = comp;
          competencesContainer.appendChild(badge);
        });
      }
      
      // 9. SERVICES PROPOS√âS
      if (profile.services && profile.services.length > 0) {
        console.log('üì¶ Affichage des services:', profile.services);
        const servicesContainer = document.getElementById('servicesList');
        if (servicesContainer) {
          servicesContainer.innerHTML = '';
          profile.services.forEach(service => {
            const serviceDiv = document.createElement('div');
            serviceDiv.style.cssText = 'border: 2px solid #e5e7eb; border-radius: 12px; padding: 20px; transition: all 0.3s ease;';
            serviceDiv.onmouseover = function() { this.style.borderColor = 'var(--secondary)'; this.style.boxShadow = '0 4px 12px rgba(37,99,235,0.1)'; };
            serviceDiv.onmouseout = function() { this.style.borderColor = '#e5e7eb'; this.style.boxShadow = 'none'; };
            
            serviceDiv.innerHTML = `
              <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                <h3 style="margin: 0; color: var(--primary); font-size: 1.15em;">${service.icon || 'üì¶'} ${service.name}</h3>
                <span style="color: var(--secondary); font-weight: 700; font-size: 1.2em;">√Ä partir de ${service.price}‚Ç¨</span>
              </div>
              <p style="margin: 10px 0 0 0; color: #6b7280; line-height: 1.6;">${service.description}</p>
            `;
            servicesContainer.appendChild(serviceDiv);
          });
        }
      }
      
      // 10. EXP√âRIENCES PROFESSIONNELLES
      if (profile.experience && Array.isArray(profile.experience) && profile.experience.length > 0) {
        console.log('üíº Affichage des exp√©riences:', profile.experience);
        const experienceSection = document.getElementById('experienceSection');
        const experienceList = document.getElementById('experienceList');
        
        if (experienceSection && experienceList) {
          experienceSection.style.display = 'block';
          experienceList.innerHTML = '';
          
          profile.experience.forEach(exp => {
            const expDiv = document.createElement('div');
            expDiv.style.cssText = 'border-left: 3px solid var(--secondary); padding-left: 20px; position: relative;';
            
            const yearRange = exp.yearStart === exp.yearEnd 
              ? exp.yearStart 
              : `${exp.yearStart} - ${exp.yearEnd}`;
            
            expDiv.innerHTML = `
              <div style="position: absolute; left: -9px; top: 0; width: 15px; height: 15px; background: var(--secondary); border-radius: 50%; border: 3px solid white;"></div>
              <div style="color: var(--secondary); font-weight: 700; font-size: 0.9em; margin-bottom: 5px;">${yearRange}</div>
              <h3 style="margin: 0 0 8px 0; color: var(--primary); font-size: 1.1em;">${exp.title}</h3>
              <p style="margin: 0; color: #6b7280; line-height: 1.6;">${exp.description || ''}</p>
            `;
            experienceList.appendChild(expDiv);
          });
        }
      }
      
      // 11. PORTFOLIO IMAGES
      if (profile.portfolio_images && profile.portfolio_images.length > 0) {
        console.log('üñºÔ∏è Affichage portfolio:', profile.portfolio_images);
        const portfolioSection = document.querySelector('h2:has(+ div > div[style*="grid-template-columns: repeat(3"])');
        const portfolioGrid = portfolioSection ? portfolioSection.nextElementSibling.querySelector('div') : null;
        
        if (portfolioGrid) {
          portfolioGrid.innerHTML = '';
          profile.portfolio_images.forEach((imgUrl, index) => {
            const imgContainer = document.createElement('div');
            imgContainer.style.cssText = 'aspect-ratio: 1; overflow: hidden; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); cursor: pointer; transition: transform 0.3s ease;';
            imgContainer.onmouseover = function() { this.style.transform = 'scale(1.05)'; };
            imgContainer.onmouseout = function() { this.style.transform = 'scale(1)'; };
            imgContainer.innerHTML = `<img src="${imgUrl}" alt="Projet ${index + 1}" style="width: 100%; height: 100%; object-fit: cover;">`;
            portfolioGrid.appendChild(imgContainer);
          });
        }
      }
      
      // 12. MASQUER LES BADGES SI N√âCESSAIRE
      if (!profile.premium_plan) {
        const topBadge = document.getElementById('topBadge');
        if (topBadge) topBadge.style.display = 'none';
      }
      
      document.title = `${profile.first_name} ${profile.last_name} ‚Äì ${title} ‚Äì Marronner`;
      console.log('‚úÖ Profil affich√© avec succ√®s');
    }

    function addEditButton() {
      // Ajouter un bouton pour modifier le profil
      const headerDiv = document.querySelector('[style*="background: linear-gradient(135deg, var(--primary)"]');
      if (headerDiv) {
        const editBtn = document.createElement('a');
        editBtn.href = 'onboarding.html';
        editBtn.style.cssText = 'display: block; margin-top: 15px; padding: 12px 24px; background: white; color: var(--primary); text-decoration: none; border-radius: 8px; font-weight: 600; text-align: center; transition: all 0.3s ease;';
        editBtn.textContent = '‚úèÔ∏è Modifier mon profil';
        editBtn.onmouseover = function() { this.style.transform = 'translateY(-2px)'; this.style.boxShadow = '0 4px 12px rgba(0,0,0,0.2)'; };
        editBtn.onmouseout = function() { this.style.transform = 'translateY(0)'; this.style.boxShadow = 'none'; };
        headerDiv.appendChild(editBtn);
      }
    }

    function loadFictiveProfile(name) {
      // Base de donn√©es fictive des marronneurs
      const marronneurs = {
        'Marie Dupont': {
          avatar: 'üë®‚Äçüé®',
          name: 'Marie Dupont',
          title: 'Designer graphique',
          rating: '4.9',
          reviews: '45',
          location: 'Saint-Denis, La R√©union',
          experience: '8+ ann√©es',
          projects: '127 projets',
          delay: '5-7 jours',
          rate: '35‚Ç¨ - 50‚Ç¨/h',
          topBadge: true,
          verified: true,
          about: "Designer graphique passionn√©e avec plus de 8 ans d'exp√©rience dans la cr√©ation d'identit√©s visuelles. Sp√©cialis√©e en branding, logos, et supports de communication. J'accompagne les entreprises locales de La R√©union dans le d√©veloppement de leur image de marque. Mon approche allie cr√©ativit√©, professionnalisme et √©coute attentive de vos besoins."
        },
        'Lucas Martin': {
          avatar: 'üé®',
          name: 'Lucas Martin',
          title: 'Illustrateur & Designer',
          rating: '4.7',
          reviews: '28',
          location: 'Saint-Pierre, La R√©union',
          experience: '5 ann√©es',
          projects: '83 projets',
          delay: '7-10 jours',
          rate: '30‚Ç¨ - 45‚Ç¨/h',
          topBadge: false,
          verified: true,
          about: "Illustrateur et designer cr√©atif sp√©cialis√© dans les identit√©s visuelles uniques. Je combine art traditionnel et outils num√©riques pour cr√©er des designs qui marquent les esprits. Passionn√© par la culture r√©unionnaise, j'int√®gre des √©l√©ments locaux dans mes cr√©ations pour un rendu authentique."
        },
        'Sophie Leroy': {
          avatar: 'üñåÔ∏è',
          name: 'Sophie Leroy',
          title: 'Directrice artistique',
          rating: '5.0',
          reviews: '12',
          location: 'Le Port, La R√©union',
          experience: '12+ ann√©es',
          projects: '95 projets',
          delay: '10-14 jours',
          rate: '50‚Ç¨ - 75‚Ç¨/h',
          topBadge: true,
          verified: true,
          about: "Directrice artistique senior avec plus de 12 ans d'exp√©rience en agence et en freelance. Mon expertise couvre la strat√©gie de marque compl√®te, du concept √† l'ex√©cution. Je propose une approche premium pour les entreprises qui souhaitent se d√©marquer avec une identit√© visuelle forte et coh√©rente sur tous les supports."
        }
      };

      const marronneur = marronneurs[name] || marronneurs['Marie Dupont'];

      // Mettre √† jour tous les √©l√©ments
      document.getElementById('marronneurAvatar').textContent = marronneur.avatar;
      document.getElementById('marronneurName').textContent = marronneur.name;
      document.getElementById('marronneurTitle').textContent = marronneur.title;
      document.getElementById('marronneurRating').textContent = marronneur.rating;
      document.getElementById('marronneurReviews').textContent = marronneur.reviews;
      document.getElementById('reviewsCount').textContent = marronneur.reviews;
      document.getElementById('marronneurLocation').textContent = marronneur.location;
      document.getElementById('marronneurExperience').textContent = marronneur.experience;
      document.getElementById('marronneurProjects').textContent = marronneur.projects;
      document.getElementById('marronneurDelay').textContent = marronneur.delay;
      document.getElementById('marronneurRate').textContent = marronneur.rate;
      document.getElementById('marronneurAbout').textContent = marronneur.about;

      // Afficher/masquer les badges
      if (!marronneur.topBadge) {
        document.getElementById('topBadge').style.display = 'none';
      }
      if (!marronneur.verified) {
        document.getElementById('verifiedBadge').style.display = 'none';
      }

      // Mettre √† jour le titre de la page
      document.title = `${marronneur.name} ‚Äì ${marronneur.title} ‚Äì Marronner`;
    }

    function contactMarronneur() {
      alert('üí¨ Redirection vers la messagerie...');
      window.location.href = 'messagerie.html';
    }

    function addToFavorites() {
      alert('‚≠ê Marronneur ajout√© √† vos favoris !');
    }

    // Animation des boutons
    document.querySelectorAll('button').forEach(btn => {
      btn.addEventListener('mouseenter', function() {
        if (this.style.background.includes('gradient')) {
          this.style.transform = 'translateY(-2px)';
          this.style.boxShadow = '0 8px 24px rgba(37, 99, 235, 0.3)';
        } else if (this.style.background === 'white') {
          this.style.background = 'var(--secondary)';
          this.style.color = 'white';
        } else if (this.style.background.includes('f3f4f6')) {
          this.style.background = '#e5e7eb';
        }
      });
      
      btn.addEventListener('mouseleave', function() {
        if (this.style.background.includes('gradient')) {
          this.style.transform = 'translateY(0)';
          this.style.boxShadow = 'none';
        } else if (this.style.color === 'white' && this.style.border) {
          this.style.background = 'white';
          this.style.color = 'var(--secondary)';
        } else if (this.style.background.includes('e5e7eb')) {
          this.style.background = '#f3f4f6';
        }
      });
    });
  </script>

  <!-- CHATBOT IA -->
  <button id="chatbotButton" aria-label="Assistant virtuel">üí¨</button>

  <div id="chatbotPanel">
    <div class="chatbot-header">
      <h3>Assistant Marronner</h3>
      <button id="chatbotClose" aria-label="Fermer">√ó</button>
    </div>
    
    <div id="chatbotMessages"></div>
    
    <div id="chatbotSuggestions"></div>
    
    <div class="chatbot-input-area">
      <input type="text" id="chatbotInput" placeholder="Pose ta question...">
      <button id="chatbotSend" aria-label="Envoyer">‚û§</button>
    </div>
  </div>

  <script src="js/chatbot.js?v=20241202-2040"></script>
</body>
</html>
